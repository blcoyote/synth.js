<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modular Synthesizer</title>
  <link rel="stylesheet" href="synth.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéπ Modular Synthesizer</h1>
      <p>Professional sound synthesis with multiple oscillators and real-time control</p>
    </div>

    <div class="init-section">
      <button id="initBtn" class="init-btn">Initialize Audio System</button>
    </div>

    <!-- Three column layout: Oscillators | Envelopes & Modulation | Effects & Filter -->
    <div class="synth-layout-grid">
      
      <!-- LEFT COLUMN: OSCILLATORS -->
      <div class="synth-column oscillators-column">
        <div class="column-header">
          <h2>üéµ Oscillators</h2>
        </div>

        <!-- Oscillator 1 -->
        <div class="module" data-type="oscillator">
        <div class="module-header">
          <div class="module-title">
            <span class="module-icon">„Ä∞Ô∏è</span>
            Oscillator 1
          </div>
          <div class="power-indicator on" id="osc1-power"></div>
        </div>
        
        <div class="oscillator-controls">
          <div class="control-group">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <div class="waveform-select">
              <button class="waveform-btn" data-osc="1" data-wave="sine">Sine</button>
              <button class="waveform-btn active" data-osc="1" data-wave="sawtooth">Saw</button>
              <button class="waveform-btn" data-osc="1" data-wave="square">Square</button>
              <button class="waveform-btn" data-osc="1" data-wave="triangle">Triangle</button>
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Octave</span>
                <span class="control-value" id="osc1-octave-value">0</span>
              </div>
              <input type="range" id="osc1-octave" min="-2" max="2" value="0" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Detune</span>
                <span class="control-value" id="osc1-detune-value">0¬¢</span>
              </div>
              <input type="range" id="osc1-detune" min="-100" max="100" value="0" step="1">
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Volume</span>
                <span class="control-value" id="osc1-volume-value">70%</span>
              </div>
              <input type="range" id="osc1-volume" min="0" max="100" value="70" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Pan</span>
                <span class="control-value" id="osc1-pan-value">Center</span>
              </div>
              <input type="range" id="osc1-pan" min="-100" max="100" value="0" step="1">
            </div>
          </div>

          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <canvas id="oscillator-waveform" width="400" height="120" style="width: 100%; height: 120px; background: #0a0a0a; border-radius: 8px; border: 2px solid #1a1a1a;"></canvas>
          </div>

          <button class="toggle-btn active" id="osc1-toggle">Disable Oscillator</button>
        </div>
      </div>

      <!-- Oscillator 2 -->
      <div class="module" data-type="oscillator">
        <div class="module-header">
          <div class="module-title">
            <span class="module-icon">„Ä∞Ô∏è</span>
            Oscillator 2
          </div>
          <div class="power-indicator" id="osc2-power"></div>
        </div>
        
        <div class="oscillator-controls">
          <div class="control-group">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <div class="waveform-select">
              <button class="waveform-btn" data-osc="2" data-wave="sine">Sine</button>
              <button class="waveform-btn active" data-osc="2" data-wave="sawtooth">Saw</button>
              <button class="waveform-btn" data-osc="2" data-wave="square">Square</button>
              <button class="waveform-btn" data-osc="2" data-wave="triangle">Triangle</button>
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Octave</span>
                <span class="control-value" id="osc2-octave-value">-1</span>
              </div>
              <input type="range" id="osc2-octave" min="-2" max="2" value="-1" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Detune</span>
                <span class="control-value" id="osc2-detune-value">-7¬¢</span>
              </div>
              <input type="range" id="osc2-detune" min="-100" max="100" value="-7" step="1">
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Volume</span>
                <span class="control-value" id="osc2-volume-value">50%</span>
              </div>
              <input type="range" id="osc2-volume" min="0" max="100" value="50" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Pan</span>
                <span class="control-value" id="osc2-pan-value">Center</span>
              </div>
              <input type="range" id="osc2-pan" min="-100" max="100" value="0" step="1">
            </div>
          </div>

          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <canvas id="oscillator2-waveform" width="400" height="120" style="width: 100%; height: 120px; background: #0a0a0a; border-radius: 8px; border: 2px solid #1a1a1a;"></canvas>
          </div>

          <!-- FM Modulation Controls -->
          <div class="control-group" style="margin-top: 15px; padding: 12px; background: rgba(147, 51, 234, 0.1); border: 1px solid rgba(147, 51, 234, 0.3); border-radius: 8px;">
            <div class="control-label" style="margin-bottom: 10px;">
              <span>üîÄ FM Modulation (Osc 1)</span>
            </div>
            <div class="control-group">
              <div class="control-label">
                <span>FM Depth</span>
                <span class="control-value" id="osc2-fm-depth-value">0 Hz</span>
              </div>
              <input type="range" id="osc2-fm-depth" min="0" max="5000" value="0" step="10">
            </div>
            <button class="toggle-btn" id="osc2-fm-toggle" style="margin-top: 10px;">Enable FM</button>
          </div>

          <button class="toggle-btn" id="osc2-toggle">Enable Oscillator</button>
        </div>
      </div>

      <!-- Oscillator 3 -->
      <div class="module" data-type="oscillator">
        <div class="module-header">
          <div class="module-title">
            <span class="module-icon">„Ä∞Ô∏è</span>
            Oscillator 3
          </div>
          <div class="power-indicator" id="osc3-power"></div>
        </div>
        
        <div class="oscillator-controls">
          <div class="control-group">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <div class="waveform-select">
              <button class="waveform-btn" data-osc="3" data-wave="sine">Sine</button>
              <button class="waveform-btn" data-osc="3" data-wave="sawtooth">Saw</button>
              <button class="waveform-btn active" data-osc="3" data-wave="square">Square</button>
              <button class="waveform-btn" data-osc="3" data-wave="triangle">Triangle</button>
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Octave</span>
                <span class="control-value" id="osc3-octave-value">1</span>
              </div>
              <input type="range" id="osc3-octave" min="-2" max="2" value="1" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Detune</span>
                <span class="control-value" id="osc3-detune-value">7¬¢</span>
              </div>
              <input type="range" id="osc3-detune" min="-100" max="100" value="7" step="1">
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Volume</span>
                <span class="control-value" id="osc3-volume-value">40%</span>
              </div>
              <input type="range" id="osc3-volume" min="0" max="100" value="40" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Pan</span>
                <span class="control-value" id="osc3-pan-value">Center</span>
              </div>
              <input type="range" id="osc3-pan" min="-100" max="100" value="0" step="1">
            </div>
          </div>

          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <canvas id="oscillator3-waveform" width="400" height="120" style="width: 100%; height: 120px; background: #0a0a0a; border-radius: 8px; border: 2px solid #1a1a1a;"></canvas>
          </div>

          <!-- FM Modulation Controls -->
          <div class="control-group" style="margin-top: 15px; padding: 12px; background: rgba(147, 51, 234, 0.1); border: 1px solid rgba(147, 51, 234, 0.3); border-radius: 8px;">
            <div class="control-label" style="margin-bottom: 10px;">
              <span>üîÄ FM Modulation (Osc 1)</span>
            </div>
            <div class="control-group">
              <div class="control-label">
                <span>FM Depth</span>
                <span class="control-value" id="osc3-fm-depth-value">0 Hz</span>
              </div>
              <input type="range" id="osc3-fm-depth" min="0" max="5000" value="0" step="10">
            </div>
            <button class="toggle-btn" id="osc3-fm-toggle" style="margin-top: 10px;">Enable FM</button>
          </div>

          <button class="toggle-btn" id="osc3-toggle">Enable Oscillator</button>
        </div>
      </div>
      
      </div>
      <!-- END LEFT COLUMN -->

      <!-- MIDDLE COLUMN: ENVELOPES & MODULATION -->
      <div class="synth-column envelopes-column">
        <div class="column-header">
          <h2>üìà Envelopes & Modulation</h2>
        </div>

        <!-- ADSR Envelope 1 -->
        <div class="module" data-type="envelope">
        <div class="module-header">
          <div class="module-title">
            <span class="module-icon">üìà</span>
            Envelope 1
          </div>
        </div>
        
        <div class="oscillator-controls">
          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Attack</span>
                <span class="control-value" id="env1-attack-value">10ms</span>
              </div>
              <input type="range" id="env1-attack" min="1" max="2000" value="10" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Decay</span>
                <span class="control-value" id="env1-decay-value">100ms</span>
              </div>
              <input type="range" id="env1-decay" min="1" max="2000" value="100" step="1">
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Sustain</span>
                <span class="control-value" id="env1-sustain-value">70%</span>
              </div>
              <input type="range" id="env1-sustain" min="0" max="100" value="70" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Release</span>
                <span class="control-value" id="env1-release-value">300ms</span>
              </div>
              <input type="range" id="env1-release" min="1" max="5000" value="300" step="1">
            </div>
          </div>
        </div>
      </div>

      <!-- ADSR Envelope 2 -->
      <div class="module" data-type="envelope">
        <div class="module-header">
          <div class="module-title">
            <span class="module-icon">üìà</span>
            Envelope 2
          </div>
        </div>
        
        <div class="oscillator-controls">
          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Attack</span>
                <span class="control-value" id="env2-attack-value">10ms</span>
              </div>
              <input type="range" id="env2-attack" min="1" max="2000" value="10" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Decay</span>
                <span class="control-value" id="env2-decay-value">100ms</span>
              </div>
              <input type="range" id="env2-decay" min="1" max="2000" value="100" step="1">
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Sustain</span>
                <span class="control-value" id="env2-sustain-value">70%</span>
              </div>
              <input type="range" id="env2-sustain" min="0" max="100" value="70" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Release</span>
                <span class="control-value" id="env2-release-value">300ms</span>
              </div>
              <input type="range" id="env2-release" min="1" max="5000" value="300" step="1">
            </div>
          </div>
        </div>
      </div>

      <!-- ADSR Envelope 3 -->
      <div class="module" data-type="envelope">
        <div class="module-header">
          <div class="module-title">
            <span class="module-icon">üìà</span>
            Envelope 3
          </div>
        </div>
        
        <div class="oscillator-controls">
          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Attack</span>
                <span class="control-value" id="env3-attack-value">10ms</span>
              </div>
              <input type="range" id="env3-attack" min="1" max="2000" value="10" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Decay</span>
                <span class="control-value" id="env3-decay-value">100ms</span>
              </div>
              <input type="range" id="env3-decay" min="1" max="2000" value="100" step="1">
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Sustain</span>
                <span class="control-value" id="env3-sustain-value">70%</span>
              </div>
              <input type="range" id="env3-sustain" min="0" max="100" value="70" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Release</span>
                <span class="control-value" id="env3-release-value">300ms</span>
              </div>
              <input type="range" id="env3-release" min="1" max="5000" value="300" step="1">
            </div>
          </div>
        </div>
      </div>

      <!-- LFO -->
      <div class="module" data-type="lfo">
        <div class="module-header">
          <div class="module-title">
            <span class="module-icon">üåä</span>
            LFO (Vibrato)
          </div>
          <div class="power-indicator" id="lfo-power"></div>
        </div>
        
        <div class="oscillator-controls">
          <div class="control-group">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <select id="lfo-waveform" style="width: 100%; padding: 10px; background: #1a1a1a; border: 2px solid #3a3a3a; border-radius: 8px; color: #e0e0e0; font-size: 0.9rem; font-weight: 600; margin-top: 5px;">
              <option value="sine">Sine</option>
              <option value="triangle">Triangle</option>
              <option value="square">Square</option>
              <option value="sawtooth">Sawtooth</option>
              <option value="random">Random</option>
            </select>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Rate</span>
                <span class="control-value" id="lfo-rate-value">5.0 Hz</span>
              </div>
              <input type="range" id="lfo-rate" min="1" max="200" value="50" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Depth</span>
                <span class="control-value" id="lfo-depth-value">5%</span>
              </div>
              <input type="range" id="lfo-depth" min="0" max="100" value="5" step="1">
            </div>
          </div>

          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Trigger Mode</span>
            </div>
            <div style="display: flex; gap: 8px; margin-top: 8px;">
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 6px; border: 2px solid #2a2a2a; flex: 1;">
                <input type="radio" name="lfo-mode" id="lfo-mode-free" value="free" checked style="cursor: pointer;">
                <span style="font-size: 0.9rem;">Free-Running</span>
              </label>
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 6px; border: 2px solid #2a2a2a; flex: 1;">
                <input type="radio" name="lfo-mode" id="lfo-mode-trigger" value="trigger" style="cursor: pointer;">
                <span style="font-size: 0.9rem;">Note Triggered</span>
              </label>
            </div>
          </div>

          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Modulation Targets</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px;">
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 6px; border: 2px solid #2a2a2a;">
                <input type="checkbox" id="lfo-target-pitch" checked style="cursor: pointer;">
                <span style="font-size: 0.9rem;">Pitch (Vibrato)</span>
              </label>
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 6px; border: 2px solid #2a2a2a;">
                <input type="checkbox" id="lfo-target-volume" style="cursor: pointer;">
                <span style="font-size: 0.9rem;">Volume (Tremolo)</span>
              </label>
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 6px; border: 2px solid #2a2a2a;">
                <input type="checkbox" id="lfo-target-pan" style="cursor: pointer;">
                <span style="font-size: 0.9rem;">Pan (Auto-Pan)</span>
              </label>
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 6px; border: 2px solid #2a2a2a;">
                <input type="checkbox" id="lfo-target-filter" style="cursor: pointer;">
                <span style="font-size: 0.9rem;">Filter Cutoff</span>
              </label>
            </div>
          </div>

          <button class="toggle-btn" id="lfo-toggle">Enable LFO</button>
        </div>
      </div>

      </div>
      <!-- END MIDDLE COLUMN -->

      <!-- RIGHT COLUMN: FILTER & EFFECTS -->
      <div class="synth-column effects-column">
        <div class="column-header">
          <h2>üéõÔ∏è Filter & Effects</h2>
        </div>

        <!-- Filter -->
        <div class="module" data-type="filter">
        <div class="module-header">
          <div class="module-title">
            <span class="module-icon">üîä</span>
            Filter
          </div>
          <div class="power-indicator on" id="filter-power"></div>
        </div>
        
        <div class="oscillator-controls">
          <div class="control-group">
            <div class="control-label">
              <span>Type</span>
            </div>
            <select id="filter-type" style="width: 100%; padding: 10px; background: #1a1a1a; border: 2px solid #3a3a3a; border-radius: 8px; color: #e0e0e0; font-size: 0.9rem; font-weight: 600; margin-top: 5px;">
              <option value="lowpass">Lowpass (Basic)</option>
              <option value="lowpass12">Lowpass 12dB</option>
              <option value="lowpass24">Lowpass 24dB</option>
              <option value="highpass">Highpass</option>
              <option value="bandpass">Bandpass</option>
              <option value="notch">Notch</option>
              <option value="lowshelf">Low Shelf</option>
              <option value="highshelf">High Shelf</option>
              <option value="peaking">Peaking</option>
              <option value="allpass">Allpass</option>
            </select>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Cutoff</span>
                <span class="control-value" id="filter-cutoff-value">2000 Hz</span>
              </div>
              <!-- Logarithmic scale: min=log(20)‚âà2.996, max=log(20000)‚âà9.903 -->
              <input type="range" id="filter-cutoff" min="2.996" max="9.903" value="7.600" step="0.001">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Resonance</span>
                <span class="control-value" id="filter-resonance-value">1.0</span>
              </div>
              <input type="range" id="filter-resonance" min="1" max="200" value="10" step="1">
            </div>
          </div>

          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Filter Response & Spectrum</span>
            </div>
            <canvas id="audio-visualizer" width="400" height="240" style="width: 100%; height: 240px; background: #0a0a0a; border-radius: 8px; border: 2px solid #1a1a1a;"></canvas>
          </div>

          <button class="toggle-btn active" id="filter-toggle">Disable Filter</button>
        </div>
      </div>

      <!-- Effects Chain Section -->
      <div class="module" data-type="effects" style="margin-top: 20px;">
        <div class="module-header">
          <div class="module-title">
            <span class="module-icon">üéõÔ∏è</span>
            Effects Chain
          </div>
          <div class="power-indicator on" id="effects-power"></div>
        </div>

        <div class="oscillator-controls">
          <!-- Add Effect Controls -->
          <div class="control-group">
            <div class="control-label">
              <span>Add Effect</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
              <button class="waveform-btn" id="add-delay">+ Delay</button>
              <button class="waveform-btn" id="add-reverb">+ Reverb</button>
              <button class="waveform-btn" id="add-distortion">+ Distortion</button>
              <button class="waveform-btn" id="add-chorus">+ Chorus</button>
              <button class="waveform-btn" id="add-shimmer">+ Shimmer</button>
            </div>
          </div>

          <!-- Effects List Container -->
          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Active Effects</span>
              <span class="control-value" id="effects-count">0</span>
            </div>
            <div id="effects-list" style="display: flex; flex-direction: column; gap: 10px; min-height: 50px; background: #1a1a1a; padding: 10px; border-radius: 8px; border: 2px solid #2a2a2a;">
              <div style="color: #666; text-align: center; font-size: 0.85rem;">No effects added</div>
            </div>
          </div>

          <!-- Chain Bypass Toggle -->
          <button class="toggle-btn active" id="effects-toggle">Bypass Effects Chain</button>
        </div>
      </div>

      </div>
      <!-- END RIGHT COLUMN -->

    </div>
    <!-- END THREE COLUMN GRID -->

    <!-- Keyboard -->
    <div class="keyboard">
      <div class="keyboard-title">
        <span>üéπ</span>
        Keyboard (C2 - C5)
      </div>
      <div class="keys-container" id="keyboard">
        <!-- Keys will be generated by JavaScript -->
      </div>
    </div>

    <!-- Master Section -->
    <div class="master-section module" data-type="master" style="margin-top: 20px;">
      <div class="module-header">
        <div class="module-title">
          <span class="module-icon">üéöÔ∏è</span>
          Master Output
        </div>
      </div>
      <div class="master-controls">
        <div class="control-group">
          <div class="control-label">
            <span>Master Volume</span>
            <span class="control-value" id="master-volume-value">80%</span>
          </div>
          <input type="range" id="master-volume" min="0" max="100" value="80" step="1">
        </div>
      </div>
    </div>

    <div class="info-text">
      üí° <strong>How to use:</strong> Enable oscillators, then click piano keys or use your computer keyboard (A-K for white keys, W-I for black keys).
      Mix different waveforms, octaves, and detuning for rich, complex sounds!
    </div>
  </div>

  <script type="module" src="/src/synth-demo.ts"></script>
</body>
</html>
