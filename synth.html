<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modular Synthesizer</title>
  <link rel="stylesheet" href="synth.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-content">
        <div>
          <h1>üéπ Modular Synthesizer</h1>
          <p>Sound synthesis with multiple oscillators and real-time control</p>
        </div>
        <div class="system-status">
          <div class="status-led" id="systemLed"></div>
          <div class="status-text">
            <div class="status-label">Audio System</div>
            <div class="status-value" id="systemStatus">Not Initialized</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Three column layout: Oscillators | Envelopes & Modulation | Effects & Filter -->
    <div class="synth-layout-grid">
      
      <!-- LEFT COLUMN: OSCILLATORS -->
      <div class="synth-column oscillators-column">
        <div class="column-header">
          <h2>üéµ Oscillators</h2>
        </div>

        <!-- Oscillator 1 -->
        <div class="module" data-type="oscillator">
        <div class="module-header collapsible" data-collapse="osc1">
          <div class="module-title">
            <span class="module-icon">„Ä∞Ô∏è</span>
            Oscillator 1
          </div>
          <div style="display: flex; align-items: center; gap: 10px;">
            <div class="power-indicator on" id="osc1-power"></div>
            <span class="collapse-icon">‚ñº</span>
          </div>
        </div>
        
        <div class="oscillator-controls collapsible-content" id="osc1-content">
          <div class="control-group">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <div class="waveform-select">
              <button class="waveform-btn" data-osc="1" data-wave="sine">Sine</button>
              <button class="waveform-btn active" data-osc="1" data-wave="sawtooth">Saw</button>
              <button class="waveform-btn" data-osc="1" data-wave="square">Square</button>
              <button class="waveform-btn" data-osc="1" data-wave="triangle">Triangle</button>
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Octave</span>
                <span class="control-value" id="osc1-octave-value">0</span>
              </div>
              <input type="range" id="osc1-octave" min="-2" max="2" value="0" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Detune</span>
                <span class="control-value" id="osc1-detune-value">0¬¢</span>
              </div>
              <input type="range" id="osc1-detune" min="-100" max="100" value="0" step="1">
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Volume</span>
                <span class="control-value" id="osc1-volume-value">70%</span>
              </div>
              <input type="range" id="osc1-volume" min="0" max="100" value="70" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Pan</span>
                <span class="control-value" id="osc1-pan-value">Center</span>
              </div>
              <input type="range" id="osc1-pan" min="-100" max="100" value="0" step="1">
            </div>
          </div>

          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <canvas id="oscillator-waveform" width="400" height="120" style="width: 100%; height: 120px; background: #0a0a0a; border-radius: 8px; border: 2px solid #1a1a1a;"></canvas>
          </div>

          <button class="toggle-btn active" id="osc1-toggle">Disable Oscillator</button>
        </div>
      </div>

      <!-- Oscillator 2 -->
      <div class="module" data-type="oscillator">
        <div class="module-header collapsible collapsed" data-collapse="osc2">
          <div class="module-title">
            <span class="module-icon">„Ä∞Ô∏è</span>
            Oscillator 2
          </div>
          <div style="display: flex; align-items: center; gap: 10px;">
            <div class="power-indicator" id="osc2-power"></div>
            <span class="collapse-icon">‚ñº</span>
          </div>
        </div>
        
        <div class="oscillator-controls collapsible-content collapsed" id="osc2-content">
          <div class="control-group">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <div class="waveform-select">
              <button class="waveform-btn" data-osc="2" data-wave="sine">Sine</button>
              <button class="waveform-btn active" data-osc="2" data-wave="sawtooth">Saw</button>
              <button class="waveform-btn" data-osc="2" data-wave="square">Square</button>
              <button class="waveform-btn" data-osc="2" data-wave="triangle">Triangle</button>
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Octave</span>
                <span class="control-value" id="osc2-octave-value">-1</span>
              </div>
              <input type="range" id="osc2-octave" min="-2" max="2" value="-1" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Detune</span>
                <span class="control-value" id="osc2-detune-value">-7¬¢</span>
              </div>
              <input type="range" id="osc2-detune" min="-100" max="100" value="-7" step="1">
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Volume</span>
                <span class="control-value" id="osc2-volume-value">50%</span>
              </div>
              <input type="range" id="osc2-volume" min="0" max="100" value="50" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Pan</span>
                <span class="control-value" id="osc2-pan-value">Center</span>
              </div>
              <input type="range" id="osc2-pan" min="-100" max="100" value="0" step="1">
            </div>
          </div>

          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <canvas id="oscillator2-waveform" width="400" height="120" style="width: 100%; height: 120px; background: #0a0a0a; border-radius: 8px; border: 2px solid #1a1a1a;"></canvas>
          </div>

          <!-- FM Modulation Controls -->
          <div class="control-group" style="margin-top: 15px; padding: 12px; background: rgba(147, 51, 234, 0.1); border: 1px solid rgba(147, 51, 234, 0.3); border-radius: 8px;">
            <div class="control-label" style="margin-bottom: 10px;">
              <span>üîÄ FM Modulation (Osc 1)</span>
            </div>
            <div class="control-group">
              <div class="control-label">
                <span>FM Depth</span>
                <span class="control-value" id="osc2-fm-depth-value">0 Hz</span>
              </div>
              <input type="range" id="osc2-fm-depth" min="0" max="5000" value="0" step="10">
            </div>
            <button class="toggle-btn" id="osc2-fm-toggle" style="margin-top: 10px;">Enable FM</button>
          </div>

          <button class="toggle-btn" id="osc2-toggle">Enable Oscillator</button>
        </div>
      </div>

      <!-- Oscillator 3 -->
      <div class="module" data-type="oscillator">
        <div class="module-header collapsible collapsed" data-collapse="osc3">
          <div class="module-title">
            <span class="module-icon">„Ä∞Ô∏è</span>
            Oscillator 3
          </div>
          <div style="display: flex; align-items: center; gap: 10px;">
            <div class="power-indicator" id="osc3-power"></div>
            <span class="collapse-icon">‚ñº</span>
          </div>
        </div>
        
        <div class="oscillator-controls collapsible-content collapsed" id="osc3-content">
          <div class="control-group">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <div class="waveform-select">
              <button class="waveform-btn" data-osc="3" data-wave="sine">Sine</button>
              <button class="waveform-btn" data-osc="3" data-wave="sawtooth">Saw</button>
              <button class="waveform-btn active" data-osc="3" data-wave="square">Square</button>
              <button class="waveform-btn" data-osc="3" data-wave="triangle">Triangle</button>
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Octave</span>
                <span class="control-value" id="osc3-octave-value">1</span>
              </div>
              <input type="range" id="osc3-octave" min="-2" max="2" value="1" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Detune</span>
                <span class="control-value" id="osc3-detune-value">7¬¢</span>
              </div>
              <input type="range" id="osc3-detune" min="-100" max="100" value="7" step="1">
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Volume</span>
                <span class="control-value" id="osc3-volume-value">40%</span>
              </div>
              <input type="range" id="osc3-volume" min="0" max="100" value="40" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Pan</span>
                <span class="control-value" id="osc3-pan-value">Center</span>
              </div>
              <input type="range" id="osc3-pan" min="-100" max="100" value="0" step="1">
            </div>
          </div>

          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <canvas id="oscillator3-waveform" width="400" height="120" style="width: 100%; height: 120px; background: #0a0a0a; border-radius: 8px; border: 2px solid #1a1a1a;"></canvas>
          </div>

          <!-- FM Modulation Controls -->
          <div class="control-group" style="margin-top: 15px; padding: 12px; background: rgba(147, 51, 234, 0.1); border: 1px solid rgba(147, 51, 234, 0.3); border-radius: 8px;">
            <div class="control-label" style="margin-bottom: 10px;">
              <span>üîÄ FM Modulation (Osc 1)</span>
            </div>
            <div class="control-group">
              <div class="control-label">
                <span>FM Depth</span>
                <span class="control-value" id="osc3-fm-depth-value">0 Hz</span>
              </div>
              <input type="range" id="osc3-fm-depth" min="0" max="5000" value="0" step="10">
            </div>
            <button class="toggle-btn" id="osc3-fm-toggle" style="margin-top: 10px;">Enable FM</button>
          </div>

          <button class="toggle-btn" id="osc3-toggle">Enable Oscillator</button>
        </div>
      </div>
      
      </div>
      <!-- END LEFT COLUMN -->

      <!-- MIDDLE COLUMN: ENVELOPES & MODULATION -->
      <div class="synth-column envelopes-column">
        <div class="column-header">
          <h2>üìà Envelopes & Modulation</h2>
        </div>

        <!-- ADSR Envelope 1 -->
        <div class="module" data-type="envelope">
        <div class="module-header collapsible" data-collapse="env1">
          <div class="module-title">
            <span class="module-icon">üìà</span>
            Envelope 1
          </div>
          <span class="collapse-icon">‚ñº</span>
        </div>
        
        <div class="oscillator-controls collapsible-content" id="env1-content">
          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Attack</span>
                <span class="control-value" id="env1-attack-value">10ms</span>
              </div>
              <input type="range" id="env1-attack" min="1" max="2000" value="10" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Decay</span>
                <span class="control-value" id="env1-decay-value">100ms</span>
              </div>
              <input type="range" id="env1-decay" min="1" max="2000" value="100" step="1">
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Sustain</span>
                <span class="control-value" id="env1-sustain-value">70%</span>
              </div>
              <input type="range" id="env1-sustain" min="0" max="100" value="70" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Release</span>
                <span class="control-value" id="env1-release-value">300ms</span>
              </div>
              <input type="range" id="env1-release" min="1" max="5000" value="300" step="1">
            </div>
          </div>
        </div>
      </div>

      <!-- ADSR Envelope 2 -->
      <div class="module" data-type="envelope">
        <div class="module-header collapsible" data-collapse="env2">
          <div class="module-title">
            <span class="module-icon">üìà</span>
            Envelope 2
          </div>
          <span class="collapse-icon">‚ñº</span>
        </div>
        
        <div class="oscillator-controls collapsible-content collapsed" id="env2-content">
          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Attack</span>
                <span class="control-value" id="env2-attack-value">10ms</span>
              </div>
              <input type="range" id="env2-attack" min="1" max="2000" value="10" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Decay</span>
                <span class="control-value" id="env2-decay-value">100ms</span>
              </div>
              <input type="range" id="env2-decay" min="1" max="2000" value="100" step="1">
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Sustain</span>
                <span class="control-value" id="env2-sustain-value">70%</span>
              </div>
              <input type="range" id="env2-sustain" min="0" max="100" value="70" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Release</span>
                <span class="control-value" id="env2-release-value">300ms</span>
              </div>
              <input type="range" id="env2-release" min="1" max="5000" value="300" step="1">
            </div>
          </div>
        </div>
      </div>

      <!-- ADSR Envelope 3 -->
      <div class="module" data-type="envelope">
        <div class="module-header collapsible" data-collapse="env3">
          <div class="module-title">
            <span class="module-icon">üìà</span>
            Envelope 3
          </div>
          <span class="collapse-icon">‚ñº</span>
        </div>
        
        <div class="oscillator-controls collapsible-content collapsed" id="env3-content">
          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Attack</span>
                <span class="control-value" id="env3-attack-value">10ms</span>
              </div>
              <input type="range" id="env3-attack" min="1" max="2000" value="10" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Decay</span>
                <span class="control-value" id="env3-decay-value">100ms</span>
              </div>
              <input type="range" id="env3-decay" min="1" max="2000" value="100" step="1">
            </div>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Sustain</span>
                <span class="control-value" id="env3-sustain-value">70%</span>
              </div>
              <input type="range" id="env3-sustain" min="0" max="100" value="70" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Release</span>
                <span class="control-value" id="env3-release-value">300ms</span>
              </div>
              <input type="range" id="env3-release" min="1" max="5000" value="300" step="1">
            </div>
          </div>
        </div>
      </div>

      <!-- LFO -->
      <div class="module" data-type="lfo">
        <div class="module-header collapsible" data-collapse="lfo">
          <div class="module-title">
            <span class="module-icon">üåä</span>
            LFO
          </div>
          <div style="display: flex; align-items: center; gap: 10px;">
            <div class="power-indicator" id="lfo-power"></div>
            <span class="collapse-icon">‚ñº</span>
          </div>
        </div>
        
        <div class="oscillator-controls collapsible-content" id="lfo-content">
          <div class="control-group">
            <div class="control-label">
              <span>Waveform</span>
            </div>
            <select id="lfo-waveform" style="width: 100%; padding: 10px; background: #1a1a1a; border: 2px solid #3a3a3a; border-radius: 8px; color: #e0e0e0; font-size: 0.9rem; font-weight: 600; margin-top: 5px;">
              <option value="sine">Sine</option>
              <option value="triangle">Triangle</option>
              <option value="square">Square</option>
              <option value="sawtooth">Sawtooth</option>
              <option value="random">Random</option>
            </select>
          </div>

          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Rate</span>
                <span class="control-value" id="lfo-rate-value">5.0 Hz</span>
              </div>
              <input type="range" id="lfo-rate" min="1" max="200" value="50" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Depth</span>
                <span class="control-value" id="lfo-depth-value">5%</span>
              </div>
              <input type="range" id="lfo-depth" min="0" max="100" value="5" step="1">
            </div>
          </div>

          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Trigger Mode</span>
            </div>
            <div style="display: flex; gap: 8px; margin-top: 8px;">
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 6px; border: 2px solid #2a2a2a; flex: 1;">
                <input type="radio" name="lfo-mode" id="lfo-mode-free" value="free" checked style="cursor: pointer;">
                <span style="font-size: 0.9rem;">Free-Running</span>
              </label>
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 6px; border: 2px solid #2a2a2a; flex: 1;">
                <input type="radio" name="lfo-mode" id="lfo-mode-trigger" value="trigger" style="cursor: pointer;">
                <span style="font-size: 0.9rem;">Note Triggered</span>
              </label>
            </div>
          </div>

          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Modulation Targets</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px;">
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 6px; border: 2px solid #2a2a2a;">
                <input type="checkbox" id="lfo-target-pitch" checked style="cursor: pointer;">
                <span style="font-size: 0.9rem;">Pitch (Vibrato)</span>
              </label>
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 6px; border: 2px solid #2a2a2a;">
                <input type="checkbox" id="lfo-target-volume" style="cursor: pointer;">
                <span style="font-size: 0.9rem;">Volume (Tremolo)</span>
              </label>
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 6px; border: 2px solid #2a2a2a;">
                <input type="checkbox" id="lfo-target-pan" style="cursor: pointer;">
                <span style="font-size: 0.9rem;">Pan (Auto-Pan)</span>
              </label>
              <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 6px; border: 2px solid #2a2a2a;">
                <input type="checkbox" id="lfo-target-filter" style="cursor: pointer;">
                <span style="font-size: 0.9rem;">Filter Cutoff</span>
              </label>
            </div>
          </div>

          <button class="toggle-btn" id="lfo-toggle">Enable LFO</button>
        </div>
      </div>

      </div>
      <!-- END MIDDLE COLUMN -->

      <!-- RIGHT COLUMN: FILTER & EFFECTS -->
      <div class="synth-column effects-column">
        <div class="column-header">
          <h2>üéõÔ∏è Filter & Effects</h2>
        </div>

      <!-- Master Section -->
      <div class="module" data-type="master" style="margin-top: 0;">
        <div class="module-header collapsible" data-collapse="master">
          <div class="module-title">
            <span class="module-icon">üéöÔ∏è</span>
            Master Output
          </div>
          <span class="collapse-icon">‚ñº</span>
        </div>
        <div class="oscillator-controls collapsible-content" id="master-content">
          <div class="control-group">
            <div class="control-label">
              <span>Master Volume</span>
              <span class="control-value" id="master-volume-value">80%</span>
            </div>
            <input type="range" id="master-volume" min="0" max="100" value="80" step="1">
          </div>
        </div>
      </div>

      <!-- Filter -->
      <div class="module" data-type="filter">
        <div class="module-header collapsible" data-collapse="filter">
          <div class="module-title">
            <span class="module-icon">üîä</span>
            Filter
          </div>
          <div style="display: flex; align-items: center; gap: 10px;">
            <div class="power-indicator on" id="filter-power"></div>
            <span class="collapse-icon">‚ñº</span>
          </div>
        </div>
        <div class="oscillator-controls collapsible-content" id="filter-content">
          <div class="control-group">
            <div class="control-label">
              <span>Type</span>
            </div>
            <select id="filter-type" style="width: 100%; padding: 10px; background: #1a1a1a; border: 2px solid #3a3a3a; border-radius: 8px; color: #e0e0e0; font-size: 0.9rem; font-weight: 600; margin-top: 5px;">
              <option value="lowpass">Lowpass (Basic)</option>
              <option value="lowpass12">Lowpass 12dB</option>
              <option value="lowpass24">Lowpass 24dB</option>
              <option value="highpass">Highpass</option>
              <option value="bandpass">Bandpass</option>
              <option value="notch">Notch</option>
              <option value="lowshelf">Low Shelf</option>
              <option value="highshelf">High Shelf</option>
              <option value="peaking">Peaking</option>
              <option value="allpass">Allpass</option>
            </select>
          </div>
          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Cutoff</span>
                <span class="control-value" id="filter-cutoff-value">2000 Hz</span>
              </div>
              <!-- Logarithmic scale: min=log(20)‚âà2.996, max=log(20000)‚âà9.903 -->
              <input type="range" id="filter-cutoff" min="2.996" max="9.903" value="7.600" step="0.001">
            </div>
            <div class="control-group">
              <div class="control-label">
                <span>Resonance</span>
                <span class="control-value" id="filter-resonance-value">1.0</span>
              </div>
              <input type="range" id="filter-resonance" min="1" max="200" value="10" step="1">
            </div>
          </div>
          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Filter Response & Spectrum</span>
            </div>
            <canvas id="audio-visualizer" width="400" height="240" style="width: 100%; height: 240px; background: #0a0a0a; border-radius: 8px; border: 2px solid #1a1a1a;"></canvas>
          </div>
          <button class="toggle-btn active" id="filter-toggle">Disable Filter</button>
        </div>
      </div>

      <!-- Effects Chain Section -->
      <div class="module" data-type="effects" style="margin-top: 20px;">
        <div class="module-header collapsible" data-collapse="effects">
          <div class="module-title">
            <span class="module-icon">üéõÔ∏è</span>
            Effects Chain
          </div>
          <div style="display: flex; align-items: center; gap: 10px;">
            <div class="power-indicator on" id="effects-power"></div>
            <span class="collapse-icon">‚ñº</span>
          </div>
        </div>
        <div class="oscillator-controls collapsible-content" id="effects-content">
          <!-- Add Effect Controls -->
          <div class="control-group">
            <div class="control-label">
              <span>Add Effect</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
              <button class="waveform-btn" id="add-delay">+ Delay</button>
              <button class="waveform-btn" id="add-reverb">+ Reverb</button>
              <button class="waveform-btn" id="add-distortion">+ Distortion</button>
              <button class="waveform-btn" id="add-chorus">+ Chorus</button>
              <button class="waveform-btn" id="add-shimmer">+ Shimmer</button>
            </div>
          </div>
          <!-- Effects List Container -->
          <div class="control-group" style="margin-top: 15px;">
            <div class="control-label">
              <span>Active Effects</span>
              <span class="control-value" id="effects-count">0</span>
            </div>
            <div id="effects-list" style="display: flex; flex-direction: column; gap: 10px; min-height: 50px; background: #1a1a1a; padding: 10px; border-radius: 8px; border: 2px solid #2a2a2a;">
              <div style="color: #666; text-align: center; font-size: 0.85rem;">No effects added</div>
            </div>
          </div>
          <!-- Chain Bypass Toggle -->
          <button class="toggle-btn active" id="effects-toggle">Bypass Effects Chain</button>
        </div>
      </div>

      </div>
      <!-- END RIGHT COLUMN -->

    </div>
    <!-- END THREE COLUMN GRID -->

    <!-- Sequencer Section -->
    <div class="module" data-type="sequencer" style="margin-top: 20px;">
      <div class="module-header collapsible" data-collapse="sequencer">
        <div class="module-title">
          <span class="module-icon">üéº</span>
          Step Sequencer
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <div class="power-indicator off" id="sequencer-power"></div>
          <span class="collapse-icon">‚ñº</span>
        </div>
      </div>

      <div class="oscillator-controls collapsible-content collapsed" id="sequencer-content">
        <!-- Transport Controls -->
        <div class="control-group">
          <div class="control-label">
            <span>Transport</span>
          </div>
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
            <button class="waveform-btn" id="seq-play">‚ñ∂Ô∏è Play</button>
            <button class="waveform-btn" id="seq-stop">‚èπÔ∏è Stop</button>
            <button class="waveform-btn" id="seq-pause">‚è∏Ô∏è Pause</button>
            <button class="waveform-btn" id="seq-reset">üîÑ Reset</button>
          </div>
        </div>

        <!-- Tempo and Swing -->
        <div class="control-row">
          <div class="control-group">
            <div class="control-label">
              <span>Tempo</span>
              <span class="control-value" id="seq-tempo-value">120 BPM</span>
            </div>
            <input type="range" id="seq-tempo" min="40" max="300" value="120" step="1">
          </div>

          <div class="control-group">
            <div class="control-label">
              <span>Swing</span>
              <span class="control-value" id="seq-swing-value">0%</span>
            </div>
            <input type="range" id="seq-swing" min="0" max="100" value="0" step="1">
          </div>
        </div>

        <!-- Step Count and Mode -->
        <div class="control-row">
          <div class="control-group">
            <div class="control-label">
              <span>Steps</span>
            </div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
              <button class="waveform-btn" data-steps="4">4</button>
              <button class="waveform-btn" data-steps="8">8</button>
              <button class="waveform-btn active" data-steps="16">16</button>
              <button class="waveform-btn" data-steps="32">32</button>
            </div>
          </div>

          <div class="control-group">
            <div class="control-label">
              <span>Mode</span>
            </div>
            <select id="seq-mode" style="width: 100%; padding: 8px; background: #1a1a1a; color: #fff; border: 2px solid #2a2a2a; border-radius: 6px; font-size: 0.9rem;">
              <option value="forward">Forward</option>
              <option value="reverse">Reverse</option>
              <option value="pingpong">Ping-Pong</option>
              <option value="random">Random</option>
            </select>
          </div>
        </div>

        <!-- Step Grid -->
        <div class="control-group" style="margin-top: 15px;">
          <div class="control-label">
            <span>Pattern</span>
            <span class="control-value" id="seq-current-step">Step: -</span>
          </div>
          <div id="step-grid" style="display: grid; grid-template-columns: repeat(16, 1fr); gap: 6px; margin-top: 10px;">
            <!-- Steps will be generated by JavaScript -->
          </div>
        </div>

        <!-- Step Editor -->
        <div class="control-group" style="margin-top: 15px;">
          <div class="control-label">
            <span>Edit Step</span>
            <span class="control-value" id="seq-edit-step">-</span>
          </div>
          
          <div class="control-row">
            <div class="control-group">
              <div class="control-label">
                <span>Note</span>
                <span class="control-value" id="seq-note-value">C3</span>
              </div>
              <input type="range" id="seq-note" min="36" max="84" value="60" step="1">
            </div>

            <div class="control-group">
              <div class="control-label">
                <span>Velocity</span>
                <span class="control-value" id="seq-velocity-value">100</span>
              </div>
              <input type="range" id="seq-velocity" min="0" max="127" value="100" step="1">
            </div>
          </div>
        </div>

        <!-- Pattern Management -->
        <div class="control-group" style="margin-top: 15px;">
          <div class="control-label">
            <span>Pattern Tools</span>
          </div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
            <button class="waveform-btn" id="seq-clear">Clear</button>
            <button class="waveform-btn" id="seq-random">Random</button>
            <button class="waveform-btn" id="seq-bassline">Bassline</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Arpeggiator Section -->
    <div class="module" data-type="arpeggiator" style="margin-top: 20px; margin-bottom: 30px;">
      <div class="module-header collapsible" data-collapse="arpeggiator">
        <div class="module-title">
          <span class="module-icon">üé∂</span>
          Arpeggiator
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <div class="power-indicator off" id="arpeggiator-power"></div>
          <span class="collapse-icon">‚ñº</span>
        </div>
      </div>

      <div class="oscillator-controls collapsible-content collapsed" id="arpeggiator-content">
        <!-- Transport Controls -->
        <div class="control-group">
          <div class="control-label">
            <span>Transport</span>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <button class="waveform-btn" id="arp-enable">‚ñ∂ Play</button>
            <button class="waveform-btn" id="arp-stop">‚èπ Stop</button>
          </div>
        </div>

        <!-- Tempo and Octaves -->
        <div class="control-row">
          <div class="control-group">
            <div class="control-label">
              <span>Tempo</span>
              <span class="control-value" id="arp-tempo-value">120 BPM</span>
            </div>
            <input type="range" id="arp-tempo" min="40" max="300" value="120" step="1">
          </div>

          <div class="control-group">
            <div class="control-label">
              <span>Octaves</span>
              <span class="control-value" id="arp-octaves-value">2</span>
            </div>
            <input type="range" id="arp-octaves" min="1" max="4" value="2" step="1">
          </div>
        </div>

        <!-- Gate and Division -->
        <div class="control-row">
          <div class="control-group">
            <div class="control-label">
              <span>Gate Length</span>
              <span class="control-value" id="arp-gate-value">80%</span>
            </div>
            <input type="range" id="arp-gate" min="10" max="100" value="80" step="5">
          </div>

          <div class="control-group">
            <div class="control-label">
              <span>Note Division</span>
            </div>
            <select id="arp-division" style="width: 100%; padding: 8px; background: #1a1a1a; color: #fff; border: 2px solid #2a2a2a; border-radius: 6px; font-size: 0.9rem;">
              <option value="1/4">Quarter Notes (1/4)</option>
              <option value="1/8">Eighth Notes (1/8)</option>
              <option value="1/16" selected>Sixteenth Notes (1/16)</option>
              <option value="1/8T">Eighth Triplets (1/8T)</option>
              <option value="1/16T">Sixteenth Triplets (1/16T)</option>
              <option value="1/32">Thirty-second Notes (1/32)</option>
            </select>
          </div>
        </div>

        <!-- Pattern Selection -->
        <div class="control-group" style="margin-top: 15px;">
          <div class="control-label">
            <span>Pattern</span>
          </div>
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
            <button class="waveform-btn active" id="arp-pattern-up">Up</button>
            <button class="waveform-btn" id="arp-pattern-down">Down</button>
            <button class="waveform-btn" id="arp-pattern-updown">Up-Down</button>
            <button class="waveform-btn" id="arp-pattern-updown2">Up-Down 2</button>
            <button class="waveform-btn" id="arp-pattern-converge">Converge</button>
            <button class="waveform-btn" id="arp-pattern-diverge">Diverge</button>
            <button class="waveform-btn" id="arp-pattern-random">Random</button>
          </div>
        </div>

        <!-- Chord Selection -->
        <div class="control-group" style="margin-top: 15px;">
          <div class="control-label">
            <span>Root Note</span>
          </div>
          <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 8px;">
            <select id="arp-root-note" style="width: 100%; padding: 8px; background: #1a1a1a; color: #fff; border: 2px solid #2a2a2a; border-radius: 6px; font-size: 0.9rem;">
              <option value="0" selected>C</option>
              <option value="1">C# / Db</option>
              <option value="2">D</option>
              <option value="3">D# / Eb</option>
              <option value="4">E</option>
              <option value="5">F</option>
              <option value="6">F# / Gb</option>
              <option value="7">G</option>
              <option value="8">G# / Ab</option>
              <option value="9">A</option>
              <option value="10">A# / Bb</option>
              <option value="11">B</option>
            </select>
            <select id="arp-root-octave" style="width: 100%; padding: 8px; background: #1a1a1a; color: #fff; border: 2px solid #2a2a2a; border-radius: 6px; font-size: 0.9rem;">
              <option value="1">Oct 1</option>
              <option value="2">Oct 2</option>
              <option value="3">Oct 3</option>
              <option value="4" selected>Oct 4</option>
              <option value="5">Oct 5</option>
              <option value="6">Oct 6</option>
              <option value="7">Oct 7</option>
              <option value="8">Oct 8</option>
            </select>
          </div>
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Chord Type</span>
          </div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
            <button class="waveform-btn arp-chord-btn active" id="arp-chord-major">Major</button>
            <button class="waveform-btn arp-chord-btn" id="arp-chord-minor">Minor</button>
            <button class="waveform-btn arp-chord-btn" id="arp-chord-major7">Maj7</button>
            <button class="waveform-btn arp-chord-btn" id="arp-chord-minor7">Min7</button>
            <button class="waveform-btn arp-chord-btn" id="arp-chord-dom7">Dom7</button>
            <button class="waveform-btn arp-chord-btn" id="arp-chord-sus4">Sus4</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Keyboard -->
    <div class="keyboard">
      <div class="keyboard-title">
        <span>üéπ</span>
        Keyboard (C2 - C5)
        <span style="font-size: 11px; opacity: 0.7; margin-left: 10px;">Arpeggiator & Sequencer support C1 - C8</span>
      </div>
      <div class="keys-container" id="keyboard">
        <!-- Keys will be generated by JavaScript -->
      </div>
    </div>

    <div class="info-text">
      üí° <strong>How to use:</strong> Enable oscillators, then click piano keys or use your computer keyboard (A-K for white keys, W-I for black keys).
      Mix different waveforms, octaves, and detuning for rich, complex sounds!
    </div>
  </div>

  <script type="module" src="/src/synth.ts"></script>
</body>
</html>
